---
phase: 03-web-frontend
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - web/src/components/date-bar.tsx
  - web/src/components/open-now-toggle.tsx
  - web/src/components/stale-banner.tsx
autonomous: true

must_haves:
  truths:
    - "Date bar shows 7 days starting from today (Pacific time) and highlights the selected date"
    - "Open Now toggle filters to only show currently-open halls"
    - "Stale banner shows relative time since last update when data is stale"
  artifacts:
    - path: "web/src/components/date-bar.tsx"
      provides: "7-day date navigation with today/tomorrow labels"
      exports: ["DateBar"]
    - path: "web/src/components/open-now-toggle.tsx"
      provides: "Toggle switch for filtering to open halls"
      exports: ["OpenNowToggle"]
    - path: "web/src/components/stale-banner.tsx"
      provides: "Relative time stale data indicator"
      exports: ["StaleBanner"]
  key_links:
    - from: "web/src/components/date-bar.tsx"
      to: "page.tsx (consumer)"
      via: "onDateChange callback prop"
      pattern: "onDateChange"
    - from: "web/src/components/open-now-toggle.tsx"
      to: "page.tsx (consumer)"
      via: "onToggle callback prop"
      pattern: "onToggle"
    - from: "web/src/components/stale-banner.tsx"
      to: "web/src/lib/types.ts"
      via: "uses MenuResponse.is_stale and fetched_at fields"
      pattern: "is_stale|fetched_at"
---

<objective>
Build the navigation and filtering components: 7-day date bar, "What's Open Now" toggle, and stale data banner.

Purpose: These components control the page-level state (which date to show, whether to filter by open status) and communicate data freshness. They sit above the hall card feed.
Output: Three standalone components ready for composition in page.tsx.
</objective>

<execution_context>
@/Users/felixpeng/.claude/get-shit-done/workflows/execute-plan.md
@/Users/felixpeng/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-frontend/03-RESEARCH.md
@.planning/phases/03-web-frontend/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DateBar component with Pacific timezone support</name>
  <files>
    web/src/components/date-bar.tsx
  </files>
  <action>
    Create `web/src/components/date-bar.tsx`:
    ```tsx
    'use client'
    ```

    Props: `selectedDate: string` (YYYY-MM-DD format), `onDateChange: (date: string) => void`

    Implementation:
    1. `getPacificToday()` helper: compute today's date in Pacific timezone using:
       ```ts
       new Date().toLocaleDateString('en-CA', { timeZone: 'America/Los_Angeles' })
       ```
       This returns YYYY-MM-DD format in Pacific time. This ensures a user in EST after midnight PST still sees the correct "today" for California dining halls.

    2. `getDateRange()`: generate array of 7 Date objects starting from Pacific today. For each day i (0-6), create a Date from the Pacific today string + i days using UTC arithmetic to avoid timezone shift issues:
       ```ts
       const base = new Date(pacificToday + 'T12:00:00') // noon to avoid DST edge
       const d = new Date(base)
       d.setDate(base.getDate() + i)
       ```

    3. `formatDateLabel(date, pacificToday)`: returns "Today" if date matches Pacific today, "Tomorrow" if +1, else short format like "Mon, Feb 10" using `toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })`.

    4. `toDateString(date)`: returns YYYY-MM-DD from Date using `toISOString().slice(0, 10)` -- safe because dates are constructed at noon UTC.

    5. Render: horizontal scrollable flex row (`flex gap-2 overflow-x-auto py-2 px-1`). Add CSS class `no-scrollbar` (or use `scrollbar-hide` if Tailwind plugin available, otherwise add a small CSS utility in globals.css: `.no-scrollbar::-webkit-scrollbar { display: none }` and `.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }`).

    6. Each date button:
       - Selected: `bg-gray-900 text-white dark:bg-white dark:text-gray-900` (inverted for dark mode)
       - Unselected: `bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400`
       - Common: `shrink-0 px-3 py-2 rounded-lg text-sm font-medium transition-colors`

    IMPORTANT: Use Pacific time for "today" computation. The backend assumes all dates are Pacific. A user viewing at 1am EST (10pm PST yesterday) should see yesterday's Pacific date as "today".
  </action>
  <verify>
    Run `cd web && npx tsc --noEmit` -- no type errors.
    Verify `web/src/components/date-bar.tsx` exists and exports DateBar.
  </verify>
  <done>
    DateBar renders 7 days starting from Pacific today with Today/Tomorrow labels. Selected date is visually highlighted. Dark mode renders correctly with inverted selected state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create OpenNowToggle and StaleBanner components</name>
  <files>
    web/src/components/open-now-toggle.tsx
    web/src/components/stale-banner.tsx
    web/src/app/globals.css
  </files>
  <action>
    1. Create `web/src/components/open-now-toggle.tsx`:
       ```tsx
       'use client'
       ```
       Props: `enabled: boolean`, `onToggle: (enabled: boolean) => void`

       Render a toggle button (not a native checkbox -- a styled pill toggle):
       - Active state: `bg-green-500 text-white` with "Open Now" label
       - Inactive state: `bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300` with "Open Now" label
       - Common: `px-4 py-2 rounded-full text-sm font-medium transition-colors cursor-pointer`
       - On click: call `onToggle(!enabled)`
       - Include a small dot indicator: green dot when active, gray when inactive, before the text

    2. Create `web/src/components/stale-banner.tsx`:
       ```tsx
       'use client'
       ```
       Props: `fetchedAt: string | null`, `isStale: boolean`

       Implementation:
       - If `!isStale || !fetchedAt`, return null (render nothing)
       - `timeAgo(isoString)` helper using `Intl.RelativeTimeFormat`:
         - Compute seconds difference: `Math.floor((Date.now() - new Date(isoString).getTime()) / 1000)`
         - Create `new Intl.RelativeTimeFormat('en', { numeric: 'auto' })`
         - If < 60s: format seconds
         - If < 3600s: format minutes
         - If < 86400s: format hours
         - Else: format days
       - Render: amber-tinted banner with icon
         ```
         bg-amber-50 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 text-xs px-3 py-1.5 rounded-lg
         ```
       - Text: "Last updated {timeAgo(fetchedAt)}"

       IMPORTANT: Use native `Intl.RelativeTimeFormat` (not date-fns) to avoid an extra dependency. It is well-supported in all modern browsers.

    3. Add no-scrollbar utility to `web/src/app/globals.css` (append after existing content):
       ```css
       /* Hide scrollbar for date bar horizontal scroll */
       .no-scrollbar::-webkit-scrollbar {
         display: none;
       }
       .no-scrollbar {
         -ms-overflow-style: none;
         scrollbar-width: none;
       }
       ```
  </action>
  <verify>
    Run `cd web && npx tsc --noEmit` -- no type errors.
    Verify all 3 files exist: open-now-toggle.tsx, stale-banner.tsx, globals.css updated.
    Run `cd web && npm run build` -- build succeeds.
  </verify>
  <done>
    OpenNowToggle renders a styled pill toggle. StaleBanner shows relative time using Intl.RelativeTimeFormat. Both components handle dark mode. No-scrollbar CSS utility available for DateBar.
  </done>
</task>

</tasks>

<verification>
1. `cd web && npx tsc --noEmit` passes
2. `cd web && npm run build` succeeds
3. DateBar uses Pacific timezone for "today" computation
4. OpenNowToggle has active/inactive visual states
5. StaleBanner returns null when not stale, shows relative time when stale
6. globals.css has no-scrollbar utility classes
</verification>

<success_criteria>
- DateBar exports and renders 7 days with Pacific timezone "today"
- OpenNowToggle exports and toggles between active/inactive states
- StaleBanner exports and shows relative time from fetched_at
- All components support dark mode via Tailwind dark: variants
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-frontend/03-03-SUMMARY.md`
</output>
