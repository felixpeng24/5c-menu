---
phase: 03-web-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - web/package.json
  - web/tsconfig.json
  - web/next.config.ts
  - web/postcss.config.mjs
  - web/vitest.config.mts
  - web/src/test-setup.ts
  - web/src/app/globals.css
  - web/src/app/layout.tsx
  - web/src/lib/api.ts
  - web/src/lib/types.ts
  - web/src/lib/constants.ts
  - web/src/lib/query-provider.tsx
  - web/src/lib/hooks.ts
autonomous: true

must_haves:
  truths:
    - "Next.js 15 dev server starts without errors on localhost:3000"
    - "TanStack Query provider wraps the app so useQuery hooks function"
    - "API client can fetch from all 3 backend endpoints"
    - "Tailwind v4 CSS classes render correctly with @theme school colors"
    - "Vitest runs and finds test files"
  artifacts:
    - path: "web/package.json"
      provides: "Next.js 15, TanStack Query v5, Tailwind v4, Vitest dependencies"
      contains: "next"
    - path: "web/src/lib/api.ts"
      provides: "API client for halls, menus, open-now endpoints"
      exports: ["fetchHalls", "fetchMenu", "fetchOpenNow"]
    - path: "web/src/lib/types.ts"
      provides: "TypeScript types matching backend schemas"
      exports: ["HallResponse", "MenuResponse", "OpenHallResponse"]
    - path: "web/src/lib/hooks.ts"
      provides: "TanStack Query hooks for each endpoint"
      exports: ["useHalls", "useMenu", "useOpenNow"]
    - path: "web/src/lib/query-provider.tsx"
      provides: "Client-side QueryClientProvider wrapper"
      exports: ["QueryProvider"]
    - path: "web/src/lib/constants.ts"
      provides: "Hall colors, dietary tag icons, meal periods"
      exports: ["HALL_MEALS", "DIETARY_ICONS", "COLLEGE_BG"]
    - path: "web/src/app/globals.css"
      provides: "Tailwind v4 import + @theme school colors"
      contains: "@import"
    - path: "web/src/app/layout.tsx"
      provides: "Root layout wrapping QueryProvider"
      contains: "QueryProvider"
    - path: "web/vitest.config.mts"
      provides: "Vitest configuration with jsdom and React plugin"
      contains: "vitest"
  key_links:
    - from: "web/src/app/layout.tsx"
      to: "web/src/lib/query-provider.tsx"
      via: "import and render as wrapper"
      pattern: "QueryProvider"
    - from: "web/src/lib/hooks.ts"
      to: "web/src/lib/api.ts"
      via: "queryFn calls fetch functions"
      pattern: "fetchHalls|fetchMenu|fetchOpenNow"
    - from: "web/src/lib/api.ts"
      to: "NEXT_PUBLIC_API_URL"
      via: "environment variable for API base URL"
      pattern: "NEXT_PUBLIC_API_URL"
---

<objective>
Scaffold the Next.js 15 web application with all infrastructure: TanStack Query provider, Tailwind CSS v4 with school colors, API client, TypeScript types, constants, custom query hooks, and Vitest test configuration.

Purpose: Establish the foundation that all UI components and the page assembly depend on. Nothing visual yet -- just the plumbing.
Output: A working Next.js 15 dev server with API client, query hooks, and Vitest ready for component tests.
</objective>

<execution_context>
@/Users/felixpeng/.claude/get-shit-done/workflows/execute-plan.md
@/Users/felixpeng/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-frontend/03-RESEARCH.md

# Backend schemas (exact API contracts)
@backend/app/schemas/halls.py
@backend/app/schemas/menus.py
@backend/app/schemas/open_now.py
@backend/app/services/menu_service.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 app and install all dependencies</name>
  <files>
    web/package.json
    web/tsconfig.json
    web/next.config.ts
    web/postcss.config.mjs
    web/src/app/globals.css
    web/src/app/layout.tsx
    web/src/app/page.tsx
    web/vitest.config.mts
    web/src/test-setup.ts
    web/.env.example
  </files>
  <action>
    1. Remove the existing `web/.gitkeep` file.

    2. Scaffold from the repo root:
       ```
       npx create-next-app@15 web --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
       ```
       This creates Next.js 15 LTS (NOT 16 which `@latest` would give). It auto-configures Tailwind, TypeScript, ESLint, App Router, and src/ directory.

    3. Install additional dependencies from inside `web/`:
       ```
       npm install @tanstack/react-query
       npm install -D vitest @vitejs/plugin-react jsdom @testing-library/react @testing-library/dom @testing-library/jest-dom vite-tsconfig-paths
       ```

    4. Replace `web/postcss.config.mjs` content to use Tailwind v4 PostCSS plugin:
       ```js
       const config = {
         plugins: {
           "@tailwindcss/postcss": {},
         },
       };
       export default config;
       ```
       IMPORTANT: Do NOT use `tailwindcss` as plugin name -- that is v3 syntax and will error.

    5. Replace `web/src/app/globals.css` with Tailwind v4 imports and school color theme:
       ```css
       @import "tailwindcss";

       @theme {
         --color-hmc: #F5C518;
         --color-cmc: #800000;
         --color-scripps: #2E4057;
         --color-pitzer: #FF6600;
         --color-pomona: #003B5C;
       }
       ```
       IMPORTANT: Use `@import "tailwindcss"` (v4 syntax), NOT `@tailwind base; @tailwind components; @tailwind utilities;` (v3 syntax).

    6. Create `web/vitest.config.mts`:
       ```ts
       import { defineConfig } from 'vitest/config'
       import react from '@vitejs/plugin-react'
       import tsconfigPaths from 'vite-tsconfig-paths'

       export default defineConfig({
         plugins: [tsconfigPaths(), react()],
         test: {
           environment: 'jsdom',
           globals: true,
           setupFiles: './src/test-setup.ts',
         },
       })
       ```

    7. Create `web/src/test-setup.ts`:
       ```ts
       import '@testing-library/jest-dom/vitest'
       ```

    8. Add test script to `web/package.json`:
       ```json
       "scripts": {
         ...existing scripts,
         "test": "vitest",
         "test:run": "vitest run"
       }
       ```

    9. Create `web/.env.example`:
       ```
       NEXT_PUBLIC_API_URL=http://localhost:8000
       ```

    10. Replace the default `web/src/app/page.tsx` with a minimal placeholder:
        ```tsx
        export default function Home() {
          return (
            <main className="min-h-screen bg-gray-50 dark:bg-gray-950">
              <h1 className="text-2xl font-bold p-4">5C Menu</h1>
            </main>
          )
        }
        ```

    11. If `create-next-app` generated a `tailwind.config.ts`, delete it -- Tailwind v4 uses CSS-first config via `@theme` in globals.css, not a JS config file.

    NOTE: `create-next-app@15` may scaffold with Tailwind v3 or v4 depending on its template version. After scaffold, verify: if `postcss.config.mjs` references `tailwindcss` plugin (v3 style), replace it with `@tailwindcss/postcss` (v4 style). If globals.css has `@tailwind base/components/utilities`, replace with `@import "tailwindcss"`. Install `@tailwindcss/postcss` if not already present: `npm install -D @tailwindcss/postcss`.
  </action>
  <verify>
    Run `cd web && npm run build` -- build completes without errors.
    Run `cd web && npx vitest run --passWithNoTests` -- Vitest runs and exits 0.
    Verify `web/package.json` contains `next`, `@tanstack/react-query`, `vitest`, `tailwindcss`.
  </verify>
  <done>
    Next.js 15 app scaffolded with Tailwind v4, TanStack Query, and Vitest installed. Build succeeds. Vitest runs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create API client, types, constants, query hooks, and QueryProvider</name>
  <files>
    web/src/lib/api.ts
    web/src/lib/types.ts
    web/src/lib/constants.ts
    web/src/lib/query-provider.tsx
    web/src/lib/hooks.ts
    web/src/app/layout.tsx
  </files>
  <action>
    1. Create `web/src/lib/types.ts` -- TypeScript interfaces matching backend Pydantic schemas EXACTLY:
       ```ts
       export interface HallResponse {
         id: string
         name: string
         college: string
         vendor_type: string
         color: string | null
       }

       export interface MenuItemResponse {
         name: string
         tags: string[]
       }

       export interface StationResponse {
         name: string
         items: MenuItemResponse[]
       }

       export interface MenuResponse {
         hall_id: string
         date: string
         meal: string
         stations: StationResponse[]
         is_stale: boolean
         fetched_at: string | null
       }

       export interface OpenHallResponse {
         id: string
         name: string
         college: string
         color: string | null
         current_meal: string
       }
       ```

    2. Create `web/src/lib/api.ts` -- centralized API client reading base URL from env:
       ```ts
       import type { HallResponse, MenuResponse, OpenHallResponse } from './types'

       const API_BASE = process.env.NEXT_PUBLIC_API_URL ?? 'http://localhost:8000'

       async function apiFetch<T>(path: string): Promise<T> {
         const res = await fetch(`${API_BASE}${path}`)
         if (!res.ok) throw new Error(`API error: ${res.status}`)
         return res.json()
       }

       export const fetchHalls = () => apiFetch<HallResponse[]>('/api/v2/halls/')
       export const fetchMenu = (hallId: string, date: string, meal: string) =>
         apiFetch<MenuResponse>(`/api/v2/menus/?hall_id=${hallId}&date=${date}&meal=${meal}`)
       export const fetchOpenNow = () => apiFetch<OpenHallResponse[]>('/api/v2/open-now/')
       ```

    3. Create `web/src/lib/constants.ts` -- hall color map, dietary icons, and meal configs:
       ```ts
       // Map college slug -> Tailwind @theme bg class (defined in globals.css)
       export const COLLEGE_BG: Record<string, string> = {
         hmc: 'bg-hmc',
         cmc: 'bg-cmc',
         scripps: 'bg-scripps',
         pitzer: 'bg-pitzer',
         pomona: 'bg-pomona',
       }

       // Dietary tag -> emoji icon (tags come as lowercase strings from backend)
       export const DIETARY_ICONS: Record<string, string> = {
         vegan: 'V',
         vegetarian: 'VG',
         'gluten-free': 'GF',
         'contains nuts': 'N',
         halal: 'HL',
         'made without gluten': 'GF',
       }

       // Meal periods per hall (derived from backend HALL_CONFIG + known hall schedules)
       // Oldenborg only serves lunch. All others serve breakfast, lunch, dinner.
       export const HALL_MEALS: Record<string, string[]> = {
         hoch: ['breakfast', 'lunch', 'dinner'],
         collins: ['breakfast', 'lunch', 'dinner'],
         malott: ['breakfast', 'lunch', 'dinner'],
         mcconnell: ['breakfast', 'lunch', 'dinner'],
         frank: ['breakfast', 'lunch', 'dinner'],
         frary: ['breakfast', 'lunch', 'dinner'],
         oldenborg: ['lunch'],
       }

       // Default meal to show when no meal is actively serving
       export const DEFAULT_MEAL = 'lunch'
       ```

    4. Create `web/src/lib/query-provider.tsx` -- 'use client' wrapper for QueryClientProvider:
       ```tsx
       'use client'

       import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
       import { useState } from 'react'

       export function QueryProvider({ children }: { children: React.ReactNode }) {
         const [queryClient] = useState(
           () =>
             new QueryClient({
               defaultOptions: {
                 queries: {
                   staleTime: 60 * 1000,
                   refetchOnWindowFocus: false,
                 },
               },
             })
         )

         return (
           <QueryClientProvider client={queryClient}>
             {children}
           </QueryClientProvider>
         )
       }
       ```
       IMPORTANT: Use `useState(() => new QueryClient(...))` pattern to avoid recreating client on re-renders.

    5. Create `web/src/lib/hooks.ts` -- custom query hooks for each endpoint:
       ```tsx
       'use client'

       import { useQuery } from '@tanstack/react-query'
       import { fetchHalls, fetchMenu, fetchOpenNow } from './api'
       import type { HallResponse, MenuResponse, OpenHallResponse } from './types'

       export function useHalls() {
         return useQuery<HallResponse[]>({
           queryKey: ['halls'],
           queryFn: fetchHalls,
           staleTime: 5 * 60 * 1000, // halls metadata changes rarely
         })
       }

       export function useMenu(hallId: string, date: string, meal: string) {
         return useQuery<MenuResponse>({
           queryKey: ['menu', hallId, date, meal],
           queryFn: () => fetchMenu(hallId, date, meal),
           enabled: !!hallId && !!date && !!meal,
         })
       }

       export function useOpenNow() {
         return useQuery<OpenHallResponse[]>({
           queryKey: ['open-now'],
           queryFn: fetchOpenNow,
           refetchInterval: 60 * 1000, // poll every 60s for live status
         })
       }
       ```

    6. Update `web/src/app/layout.tsx` to wrap with QueryProvider:
       ```tsx
       import type { Metadata } from 'next'
       import { QueryProvider } from '@/lib/query-provider'
       import './globals.css'

       export const metadata: Metadata = {
         title: '5C Menu',
         description: 'Dining hall menus for the Claremont Colleges',
       }

       export default function RootLayout({
         children,
       }: {
         children: React.ReactNode
       }) {
         return (
           <html lang="en" suppressHydrationWarning>
             <body className="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 antialiased">
               <QueryProvider>{children}</QueryProvider>
             </body>
           </html>
         )
       }
       ```
       IMPORTANT: `suppressHydrationWarning` on `<html>` prevents flash warnings from system dark mode detection.
  </action>
  <verify>
    Run `cd web && npx tsc --noEmit` -- type checking passes with no errors.
    Verify all 6 files exist: api.ts, types.ts, constants.ts, query-provider.tsx, hooks.ts, layout.tsx.
    Run `cd web && npm run build` -- build succeeds (confirms imports resolve).
  </verify>
  <done>
    API client, types, constants, query hooks, and QueryProvider all in place. Layout wraps app in QueryProvider. TypeScript compiles cleanly. Build succeeds.
  </done>
</task>

</tasks>

<verification>
1. `cd web && npm run build` passes without errors
2. `cd web && npx vitest run --passWithNoTests` exits 0
3. `cd web && npx tsc --noEmit` shows no type errors
4. `web/src/lib/types.ts` matches backend schemas exactly (HallResponse, MenuResponse, OpenHallResponse, StationResponse, MenuItemResponse)
5. `web/src/app/globals.css` contains `@import "tailwindcss"` and all 5 school color `@theme` vars
6. `web/src/app/layout.tsx` wraps children in QueryProvider
</verification>

<success_criteria>
- Next.js 15 dev server starts on localhost:3000
- TanStack Query v5 provider wraps the entire app
- API client exports fetchHalls, fetchMenu, fetchOpenNow with proper types
- Tailwind v4 with school colors defined in @theme
- Vitest configured and runnable
- TypeScript strict mode passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-frontend/03-01-SUMMARY.md`
</output>
