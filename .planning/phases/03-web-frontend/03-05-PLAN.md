---
phase: 03-web-frontend
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - web/src/__tests__/stale-banner.test.tsx
  - web/src/__tests__/date-bar.test.tsx
  - web/src/__tests__/menu-item.test.tsx
  - web/src/__tests__/open-now-toggle.test.tsx
  - web/src/__tests__/hall-card.test.tsx
autonomous: true

must_haves:
  truths:
    - "Vitest runs all component tests and they pass"
    - "StaleBanner renders nothing when not stale and shows time when stale"
    - "DateBar renders 7 date buttons with Today label for first"
    - "MenuItem renders item name and dietary tag badges"
    - "OpenNowToggle calls onToggle when clicked"
    - "HallCard renders hall name and open/closed badge"
  artifacts:
    - path: "web/src/__tests__/stale-banner.test.tsx"
      provides: "StaleBanner component tests"
      min_lines: 15
    - path: "web/src/__tests__/date-bar.test.tsx"
      provides: "DateBar component tests"
      min_lines: 15
    - path: "web/src/__tests__/menu-item.test.tsx"
      provides: "MenuItem component tests"
      min_lines: 15
    - path: "web/src/__tests__/open-now-toggle.test.tsx"
      provides: "OpenNowToggle component tests"
      min_lines: 15
    - path: "web/src/__tests__/hall-card.test.tsx"
      provides: "HallCard component tests"
      min_lines: 15
  key_links:
    - from: "web/src/__tests__/*.test.tsx"
      to: "web/src/components/*.tsx"
      via: "import and render with React Testing Library"
      pattern: "render|screen"
---

<objective>
Write Vitest component tests (TEST-03) for key frontend components: StaleBanner, DateBar, MenuItem, OpenNowToggle, and HallCard.

Purpose: Satisfy the TEST-03 requirement for key frontend component tests. Focus on behavior (rendering, user interaction, conditional display) not implementation details.
Output: 5 test files that pass with `vitest run`.
</objective>

<execution_context>
@/Users/felixpeng/.claude/get-shit-done/workflows/execute-plan.md
@/Users/felixpeng/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-web-frontend/03-RESEARCH.md
@.planning/phases/03-web-frontend/03-01-SUMMARY.md
@.planning/phases/03-web-frontend/03-02-SUMMARY.md
@.planning/phases/03-web-frontend/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tests for StaleBanner, DateBar, and MenuItem</name>
  <files>
    web/src/__tests__/stale-banner.test.tsx
    web/src/__tests__/date-bar.test.tsx
    web/src/__tests__/menu-item.test.tsx
  </files>
  <action>
    Create `web/src/__tests__/` directory if it doesn't exist.

    1. `web/src/__tests__/stale-banner.test.tsx`:
       ```tsx
       import { render, screen } from '@testing-library/react'
       import { describe, it, expect } from 'vitest'
       import { StaleBanner } from '@/components/stale-banner'
       ```
       Tests:
       - `renders nothing when isStale is false` -- render with isStale=false, expect container to be empty
       - `renders nothing when fetchedAt is null` -- render with isStale=true but fetchedAt=null, expect empty
       - `shows "Last updated" text when stale with valid fetchedAt` -- render with isStale=true and fetchedAt set to 1 hour ago (construct ISO string: `new Date(Date.now() - 3600 * 1000).toISOString()`), expect text matching /last updated/i to be in document

    2. `web/src/__tests__/date-bar.test.tsx`:
       ```tsx
       import { render, screen, fireEvent } from '@testing-library/react'
       import { describe, it, expect, vi } from 'vitest'
       import { DateBar } from '@/components/date-bar'
       ```
       Tests:
       - `renders 7 date buttons` -- render DateBar with a selectedDate and mock onDateChange, expect 7 buttons
       - `highlights selected date` -- render with today's date as selectedDate, verify the "Today" button has the selected styling class or is distinguishable
       - `calls onDateChange when a date is clicked` -- render, click a non-selected button, expect `onDateChange` to have been called with a YYYY-MM-DD string
       - `shows "Today" label for first date` -- verify text content "Today" appears

       For selectedDate, use: `new Date().toLocaleDateString('en-CA', { timeZone: 'America/Los_Angeles' })`

    3. `web/src/__tests__/menu-item.test.tsx`:
       ```tsx
       import { render, screen } from '@testing-library/react'
       import { describe, it, expect } from 'vitest'
       import { MenuItem } from '@/components/menu-item'
       ```
       Tests:
       - `renders item name` -- render with `{ name: 'Grilled Chicken', tags: [] }`, expect "Grilled Chicken" in document
       - `renders dietary tag badges` -- render with `{ name: 'Tofu Bowl', tags: ['vegan', 'gluten-free'] }`, expect "V" and "GF" to be in document (from DIETARY_ICONS constant)
       - `ignores unknown tags` -- render with `{ name: 'Mystery Meat', tags: ['unknown-tag'] }`, expect item name but no tag badge content for unknown tag
  </action>
  <verify>
    Run `cd web && npx vitest run src/__tests__/stale-banner.test.tsx src/__tests__/date-bar.test.tsx src/__tests__/menu-item.test.tsx` -- all tests pass.
  </verify>
  <done>
    3 test files created and passing. StaleBanner conditional rendering tested. DateBar renders 7 dates with Today label and handles clicks. MenuItem renders names and dietary tags.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tests for OpenNowToggle and HallCard</name>
  <files>
    web/src/__tests__/open-now-toggle.test.tsx
    web/src/__tests__/hall-card.test.tsx
  </files>
  <action>
    1. `web/src/__tests__/open-now-toggle.test.tsx`:
       ```tsx
       import { render, screen, fireEvent } from '@testing-library/react'
       import { describe, it, expect, vi } from 'vitest'
       import { OpenNowToggle } from '@/components/open-now-toggle'
       ```
       Tests:
       - `renders with "Open Now" text` -- render with enabled=false, expect "Open Now" text
       - `calls onToggle with true when clicked while disabled` -- render with enabled=false and mock onToggle, click, expect onToggle(true)
       - `calls onToggle with false when clicked while enabled` -- render with enabled=true and mock onToggle, click, expect onToggle(false)

    2. `web/src/__tests__/hall-card.test.tsx`:
       ```tsx
       import { render, screen } from '@testing-library/react'
       import { describe, it, expect } from 'vitest'
       import { HallCard } from '@/components/hall-card'
       import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
       ```

       IMPORTANT: HallCard contains MealTabs which uses `useMenu` (a TanStack Query hook). Tests must wrap HallCard in QueryClientProvider.

       Helper:
       ```tsx
       function renderWithQuery(ui: React.ReactElement) {
         const queryClient = new QueryClient({
           defaultOptions: { queries: { retry: false } }
         })
         return render(
           <QueryClientProvider client={queryClient}>{ui}</QueryClientProvider>
         )
       }
       ```

       Test data:
       ```ts
       const mockHall = {
         id: 'collins',
         name: 'Collins',
         college: 'cmc',
         vendor_type: 'bonappetit',
         color: '#800000',
       }
       ```

       Tests:
       - `renders hall name` -- renderWithQuery HallCard with mockHall, date="2026-02-09", isOpen=true. Expect "Collins" in document.
       - `shows Open badge when hall is open` -- renderWithQuery with isOpen=true, expect text "Open" in document.
       - `shows Closed badge when hall is closed` -- renderWithQuery with isOpen=false, expect text "Closed" in document.
       - `renders meal tabs` -- renderWithQuery, expect at least one button with meal name (e.g., "Breakfast" or "Lunch" text should appear since MealTabs renders tab buttons).

       NOTE: MealTabs will attempt to fetch menu data via useMenu. In test environment with no backend, it will show loading state then error. That's fine -- we're testing that the component tree renders without crashing and shows the hall name + badge.
  </action>
  <verify>
    Run `cd web && npx vitest run src/__tests__/open-now-toggle.test.tsx src/__tests__/hall-card.test.tsx` -- all tests pass.
    Run `cd web && npx vitest run` -- ALL tests pass (full suite).
  </verify>
  <done>
    5 test files total, all passing. OpenNowToggle interaction tested. HallCard rendering tested with QueryProvider wrapper. Full test suite green.
  </done>
</task>

</tasks>

<verification>
1. `cd web && npx vitest run` -- all tests pass (exit 0)
2. At least 5 test files exist in `web/src/__tests__/`
3. Each test file uses React Testing Library `render` and `screen`
4. HallCard test wraps in QueryClientProvider (required for useMenu hook)
5. StaleBanner tests cover both stale and non-stale states
6. DateBar tests verify 7 dates rendered and click handling
7. No tests depend on live backend (all are unit-level component tests)
</verification>

<success_criteria>
- `vitest run` exits 0 with all tests passing
- 5 test files exist covering: StaleBanner, DateBar, MenuItem, OpenNowToggle, HallCard
- Tests verify rendering, conditional display, and user interaction
- No external API calls in tests (pure component tests)
- TEST-03 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-web-frontend/03-05-SUMMARY.md`
</output>
